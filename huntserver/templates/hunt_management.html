{% extends "staff_base.html" %}
{% block title %}Hunt Management{% endblock title %}

{% block includes %}
  <script type="text/javascript">
    $(function() {
      $('.list-group-item').on('click', function() {
        if($('.glyphicon.glyphicon-chevron-right', this).length){
          $('.glyphicon.glyphicon-chevron-right', this)
            .toggleClass('glyphicon-chevron-right')
            .toggleClass('glyphicon-chevron-down');
        }
        else if($('.glyphicon.glyphicon-chevron-down', this).length){
          $('.glyphicon.glyphicon-chevron-down', this)
            .toggleClass('glyphicon-chevron-right')
            .toggleClass('glyphicon-chevron-down');
        }
      });
      $('.download-btn').on('click', function(e) {
        e.stopPropagation();
      })
    });
  </script>
{% endblock includes%}

{% block content %}
  <h1>Hunt Management</h1>
  <h3> Hunt Downloads: </h3>
  <div class="list-group list-group-root well" style="max-width: 700px;">
    {% for hunt in hunts %}
      <a href="#item-{{ forloop.counter }}" class="list-group-item" data-toggle="collapse">
        <i class="glyphicon glyphicon-chevron-right"></i>
        {{ hunt }}
        <form method="Post" action="/staff/control/" style="float: right;">
          {% csrf_token %}
          <input type="hidden" name="action" value="gethunt">
          <input type="hidden" name="hunt_number" value="{{hunt.hunt_number}}">
          <button type="submit" class="download-btn btn btn-success" onclick="return confirm('Are you sure?')">
            Resources <i class="glyphicon glyphicon-download"></i>
          </button>
        </form>
        <form method="Post" action="/staff/control/" style="float: right;">
          {% csrf_token %}
          <input type="hidden" name="action" value="getpuzzles">
          <input type="hidden" name="hunt_number" value="{{hunt.hunt_number}}">
          <button type="submit" class="download-btn btn btn-primary" onclick="return confirm('Are you sure?')">
            Puzzles <i class="glyphicon glyphicon-download"></i>
          </button>
        </form>
        <form method="Post" action="/staff/control/" style="float: right;">
          {% csrf_token %}
          <input type="hidden" name="action" value="new_current_hunt">
          <input type="hidden" name="hunt_number" value="{{hunt.hunt_number}}">
          <button type="submit" class="download-btn btn btn-info">
            Set Current
          </button>
        </form>
      </a>
      <div class="list-group collapse" id="item-{{ forloop.counter }}">
        {% for puzzle in hunt.puzzle_set.all|dictsort:"puzzle_number" %}
          <a href="#item-{{ forloop.parentloop.counter }}-{{ forloop.counter }}" class="list-group-item" data-toggle="collapse">
            {{ puzzle }}
            <form method="Post" action="/staff/control/" style="float: right;">
              {% csrf_token %}
              <input type="hidden" name="action" value="getpuzzles">
              <input type="hidden" name="puzzle_number" value="{{puzzle.puzzle_number}}">
              <input type="hidden" name="puzzle_id" value="{{puzzle.puzzle_id}}">
              <button type="submit" class="download-btn btn btn-primary" onclick="return confirm('Are you sure?')">
                Download
              </button>
            </form>
          </a>
        {% endfor %}
      </div>
    {% endfor %}
  </div>

  <h3> Prepuzzle Downloads: </h3>
  <div class="list-group list-group-root well" style="max-width: 700px;">
    {% for puzzle in prepuzzles|dictsort:"pk" %}
      <a href="#item-{{ forloop.counter }}" class="list-group-item">
        {{ puzzle }}
        <form method="Post" action="/staff/control/" style="float: right;">
          {% csrf_token %}
          <input type="hidden" name="action" value="getprepuzzle">
          <input type="hidden" name="puzzle_number" value="{{puzzle.pk}}">
          <button type="submit" class="download-btn btn btn-primary" onclick="return confirm('Are you sure?')">
            Download
          </button>
        </form>
      </a>
    {% endfor %}
  </div>

  <h3> Puzzle Management: </h3>
  <form method="Post" action="/staff/control/">
    {% csrf_token %}
    <input type="hidden" name="action" value="initial">
    <button type="submit" class="download-btn btn btn-warning"
            onclick="return confirm('Are you sure?')">
      Release initial puzzles
    </button>
  </form>
  <br>
  <form method="Post" action="/staff/control/">
    {% csrf_token %}
    <input type="hidden" name="action" value="reset">
    <button type="submit" class="download-btn btn btn-danger" 
            onclick="return confirm('Are you sure?')">
      Reset all progress
    </button>
  </form>
  </br>
{% endblock content %}
