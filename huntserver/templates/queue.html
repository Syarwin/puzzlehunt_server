{% extends "staff_base.html" %}
{% block title %}Queue{% endblock title %}

{% block includes %} 
  <script src="{{ STATIC_URL }}jquery.min.js"></script>
  <script src="{{ STATIC_URL }}js.cookie.js"></script>
  <script src="{{ STATIC_URL }}huntserver/queue.js"></script>
{% endblock includes %}

{% block content %}
<h1>Submission Queue</h1>

<table id='queue'>
  <thead>
    <tr>
      <th>Team</th>
      <th>Puzzle</th>
      <th>Answer</th>
      <th>Submitted At</th>
      <th>Actions</th>
    </tr>
  </thead>

  <tbody id='sub_table'>
    {% for submission in submission_list %}
    <tr class="
    {% if submission.response_text == '' %}
      incorrect-unreplied 
    {% elif submission.response_text == 'Correct!' %} 
      correct 
    {% else %}
      incorrect-replied 
    {% endif %} submission" data-id='{{ submission.pk }}'>
      <td>{{ submission.team.team_name }}</td>
      <td>{{ submission.puzzle.puzzle_name }}</td>
      <td>{{ submission.submission_text }}</td>
      <td>{{ submission.submission_time|time:"h:i a" }}</td>
      <td>
        {% if submission.response_text == '' %}
          <a href='#' class='needs-response'>[manual response]</a>
          <a href='#' class='canned-response'>[canned response]</a>
        {% else%}
          Response: {{submission.response_text}} <a href='#' class='needs-response'>Fix</a>
        {% endif  %}
        <form class='sub_form' action="/staff/queue/" method="post" style="display:none">
          {% csrf_token %}
          <p>
            <input id='id_response' maxlength='400' name='response' type='text' 
              value='{% if submission.response_text == '' %}Wrong answer{% else %}{{submission.response_text}}{% endif %}'>
            <input type="hidden" name="sub_id" value="{{ submission.pk }}">
            <input type="Submit" value="Send Response"/>
          </p>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<br>

<div class="pagination">
    <span class="step-links">
        {% if submission_list.has_previous %}
            <a href="/staff/queue/{{ submission_list.previous_page_number }}">Previous</a>
        {% endif %}

        <span class="current">
            Page {{ submission_list.number }} of {{ submission_list.paginator.num_pages }}.
        </span>

        {% if submission_list.has_next %}
            <a href="/staff/queue/{{ submission_list.next_page_number }}">Next</a>
        {% endif %}
    </span>
</div>

<audio>
  <source src="http://cmu.io/~jlareau/goat.mp3"  type="audio/mp3"/>
</audio>
{% endblock content %}
